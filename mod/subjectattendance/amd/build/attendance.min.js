define("mod_subjectattendance/attendance",["jquery"],(function($){function updateClass(select){let val=$(select).val();$(select).removeClass("present partial absent none"),"2"===val?$(select).addClass("present"):"1"===val?$(select).addClass("partial"):"0"===val?$(select).addClass("absent"):$(select).addClass("none")}return{init:function(){$(".attendance-select").each((function(){updateClass(this),$(this).on("change",(function(){updateClass(this);let studentid=$(this).data("studentid"),subjectid=$(this).data("subjectid"),cmid=$(this).data("cmid"),attendanceid=$(this).data("attendanceid"),status=$(this).val();fetch(M.cfg.wwwroot+"/mod/subjectattendance/ajax_save.php",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({sesskey:M.cfg.sesskey,studentid:studentid,subjectid:subjectid,cmid:cmid,attendanceid:attendanceid,status:status})}).then((r=>r.json())).then((data=>data.success?(function(row){let present=0,partial=0,absent=0;$(row).find(".attendance-select").each((function(){"2"===$(this).val()?present++:"1"===$(this).val()?partial++:"0"===$(this).val()&&absent++}));let $summary=$(row).find(".attendance-summary");$summary.length&&$summary.html((present?"<div style='flex: 1; background: #c8e6c9;'>"+present+"</div>":"")+(partial?"<div style='flex: 1; background: #fff9c4;'>"+partial+"</div>":"")+(absent?"<div style='flex: 1; background: #ffcdd2;'>"+absent+"</div>":""))}($(this).closest("tr")),data):(alert(data.error),null))).catch((error=>{alert(error)}))}))})),$(document).on("change",".attendance-col-select",(function(){let subjectid=$(this).data("subjectid"),value=$(this).val(),$self=$(this);if(!$self.next(".mass-apply-confirm").length){let $panel=$('\n                    <span class="mass-apply-confirm" style="margin-left:8px;">\n                        <button type="button" class="btn btn-warning btn-sm mt-2 apply">\n                        '.concat(M.util.get_string("apply","core"),'</button>\n                        <button type="button" class="btn btn-secondary btn-sm mt-2 cancel">\n                        ').concat(M.util.get_string("cancel","core"),"</button>\n                    </span>\n                "));$self.after($panel),$panel.find(".apply").on("click",(function(){$(".attendance-select[data-subjectid='"+subjectid+"']").each((function(){$(this).val(value).trigger("change")})),$panel.remove()})),$panel.find(".cancel").on("click",(function(){$self.val(""),$panel.remove()}))}}))}}}));

//# sourceMappingURL=attendance.min.js.map